<div class="panel panel-default">
  <div class="panel-heading products__products-header">
    <div class="products__products-header-item"><h2>Products</h2></div>
    <div class="products__products-header-item products__products-header-item--last" ng-if="$ctrl.statusItems">
      <chpl-filter-multiple
        items="$ctrl.statusItems"
        on-change="$ctrl.doFilter(items)">
      </chpl-filter-multiple>
      <button class="btn btn-default" ng-click="$ctrl.viewCertificationStatusLegend();$event.stopPropagation()"><i class="fa fa-question-circle"></i></button>
    </div>
  </div>
  <div class="panel-body">
    <div ng-repeat="product in $ctrl.products | orderBy: 'name'" class="products__product">
      <div class="products__product-header" ng-click="$ctrl.toggleProduct(product)">
        <div class="products__product-header-item products__product-header-item--first"><h3>{{ product.name }}</h3></div>
        <div class="products__product-header-item">{{ $ctrl.getListingCounts(product) }}</div>
        <div class="products__product-header-item">{{ product.versions ? product.versions.length : 0 }} Version<span ng-if="product.versions.length !== 1">s</span></div>
        <div class="products__product-header-item"><i class="fa" ng-class="{ 'fa-caret-down' : !product.isOpen, 'fa-caret-up' : product.isOpen }"></i></div>
      </div>
      <div ng-if="product.isOpen">
        <div id="chpl-product-{{ product.productId }}">
          <div class="product__product-info">
            <div class="product__product-info-item">
              <label for="active-version">Version</label>
              <select ng-model="product.activeVersion"
                      id="active-version" name="product.activeVersion" class="input-sm form-control"
                      ng-options="v as v.version for v in product.versions">
              </select>
            </div>
            <div class="product__product-info-item product__product-info-item--right">
              <div class="data-label">Last Modified</div>
              <div class="read-only-data">{{ product.lastModifiedDate | date : 'mediumDate' : 'UTC' }}</div>
            </div>
            <div class="product__product-info-item" ng-if="product.ownerHistory && product.ownerHistory.length > 0">
              <table class="table table-condensed">
                <thead>
                  <tr>
                    <th scope="col">Previous Owner<span ng-if="product.ownerHistory.length > 1">s</span></th>
                    <th scope="col">Effective date</th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="owner in product.ownerHistory | orderBy : '-transferDate'">
                    <td>{{ owner.developer.name }}</td>
                    <td>{{ owner.transferDate | date : 'mediumDate' : 'UTC' }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="product__product-info-item" ng-if="product.contact">
              <div class="data-label">Contact information</div>
              <chpl-contact contact="product.contact"></chpl-contact>
            </div>
          </div>
          <div class="product__listings">
            <p ng-if="$ctrl.noVisibleListings(product)">No Listings match the filter</p>
            <div class="product__listing" ng-repeat="listing in product.activeVersion.listings | filter:{displayed:true}">
              <div class="product__listing-data-item">
                <div class="data-label product__data-label" ng-class="{ 'sr-only' : !$first }">CHPL Product Number</div>
                <div class="product__listing-element"><a ui-sref="listing({ id: listing.id })">{{ listing.chplProductNumber }}</a></div>
              </div>
              <div class="product__listing-data-item">
                <div class="data-label product__data-label" ng-class="{ 'sr-only' : !$first }">Certification Status</div>
                <div class="product__listing-element"><a href uib-tooltip="{{ listing.certificationStatus }}" tooltip-trigger="'mouseenter focus click'"><i class="fa" ng-class="$ctrl.statusFont(listing.certificationStatus)"></i></a> {{ listing.certificationStatus }}</div>
              </div>
              <div class="product__listing-data-item">
                <div class="data-label product__data-label" ng-class="{ 'sr-only' : !$first }">Edition</div>
                <div class="product__listing-element">{{ listing.edition }}<span ng-if="listing.curesUpdate"> Cures Update</span></div>
              </div>
              <div class="product__listing-data-item">
                <div class="data-label product__data-label" ng-class="{ 'sr-only' : !$first }">Certification Date</div>
                <div class="product__listing-element">{{ listing.certificationDate | date : 'mediumDate' : 'UTC' }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
